<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ph Kontrol Noktaları</title>
    <link rel="stylesheet" href="styles.css"/>
</head>
<body>
    <!-- Üst Bar -->
    <div class="header">
        <div class="user-info">
            <span id="current-time"></span>
            <span id="logged-user"></span>
            <img id="logout-button" src="icons/cikis-glohe.png" alt="Çıkış" title="Çıkış"
                 onclick="logout()" style="cursor:pointer;width:30px;height:30px;">
            <button class="btn btn-ghost" onclick="showHomepage()">Anasayfa</button>
        </div>
    </div>

    <!-- Sol Menü -->
    <aside class="menu">
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>
        <ul>
            <li><a href="klor.html"><img src="icons/klor.png" alt="Klor" title="Klor"><span>Klor</span></a></li>
            <li><a href="sertlik.html"><img src="icons/sertlik.png" alt="Sertlik" title="Sertlik"><span>Sertlik</span></a></li>
            <li><a href="ph.html"><img src="icons/ph.png" alt="Ph" title="Ph"><span>Ph</span></a></li>
            <li><a href="iletkenlik.html"><img src="icons/iletkenlik.png" alt="İletkenlik" title="İletkenlik"><span>İletkenlik</span></a></li>
            <li><a href="mikro.html"><img src="icons/mikro.png" alt="Mikro Biyoloji" title="Mikro Biyoloji"><span>Mikro Biyoloji</span></a></li>
        </ul>
    </aside>

    <!-- İçerik -->
    <div class="content">
        <div class="toolbar">
            <div class="left">
                <h2>Ph Kontrol Noktaları</h2>
            </div>
            <div class="right">
                <button class="btn btn-primary" id="btn-open-modal">Yeni Kayıt</button>
                <input class="input" id="search" type="search" placeholder="Kontrol noktası ara..."/>
            </div>
        </div>

        <div id="control-points" class="control-points">
            <div class="grid">
                <div class="box" data-point="Kontrol Noktası 1">Kontrol Noktası 1</div>
                <div class="box" data-point="Kontrol Noktası 2">Kontrol Noktası 2</div>
                <div class="box" data-point="Kontrol Noktası 3">Kontrol Noktası 3</div>
                <div class="box" data-point="Kontrol Noktası 4">Kontrol Noktası 4</div>
                <div class="box" data-point="Kontrol Noktası 5">Kontrol Noktası 5</div>
                <div class="box" data-point="Kontrol Noktası 6">Kontrol Noktası 6</div>
                <div class="box" data-point="Kontrol Noktası 7">Kontrol Noktası 7</div>
                <div class="box" data-point="Kontrol Noktası 8">Kontrol Noktası 8</div>
                <div class="box" data-point="Kontrol Noktası 9">Kontrol Noktası 9</div>
                <div class="box" data-point="Kontrol Noktası 10">Kontrol Noktası 10</div>
                <div class="box" data-point="Kontrol Noktası 11">Kontrol Noktası 11</div>
                <div class="box" data-point="Kontrol Noktası 12">Kontrol Noktası 12</div>
                <div class="box" data-point="Kontrol Noktası 13">Kontrol Noktası 13</div>
            </div>
        </div>
    </div>

    <!-- Modal & Overlay -->
    <div class="overlay" id="overlay"></div>
    <div class="modal" id="entry-modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-card">
            <div class="modal-head">
                <h3 class="modal-title" id="modalTitle">Ph Ölçüm Kaydı</h3>
                <button class="btn btn-ghost" id="btn-close-modal" aria-label="Kapat">Kapat</button>
            </div>
            <form id="entry-form">
                <div class="modal-body">
                    <div class="form-grid">
                        <div>
                            <label for="point">Kontrol Noktası</label>
                            <select id="point" required>
                                <option value="">Seçiniz...</option>
                                <option>Kontrol Noktası 1</option>
                                <option>Kontrol Noktası 2</option>
                                <option>Kontrol Noktası 3</option>
                                <option>Kontrol Noktası 4</option>
                                <option>Kontrol Noktası 5</option>
                                <option>Kontrol Noktası 6</option>
                                <option>Kontrol Noktası 7</option>
                                <option>Kontrol Noktası 8</option>
                                <option>Kontrol Noktası 9</option>
                                <option>Kontrol Noktası 10</option>
                                <option>Kontrol Noktası 11</option>
                                <option>Kontrol Noktası 12</option>
                                <option>Kontrol Noktası 13</option>
                            </select>
                        </div>

                        <div>
                            <label for="value">Ölçüm Değeri</label>
                            <input id="value" type="number" step="0.1" min="0" max="14" placeholder="Örn: 7.0" required/>
                        </div>

                        <div>
                            <label for="unit">Birim</label>
                            <select id="unit" required>
                                <option value="pH">pH</option>
                            </select>
                        </div>

                        <div>
                            <label for="date">Tarih</label>
                            <input id="date" type="date" required/>
                        </div>

                        <div>
                            <label for="time">Saat</label>
                            <input id="time" type="time" required/>
                        </div>

                        <div class="full">
                            <label for="note">Açıklama</label>
                            <textarea id="note" rows="3" placeholder="İsteğe bağlı"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-foot">
                    <button type="button" class="btn btn-ghost" id="btn-cancel">Vazgeç</button>
                    <button type="submit" class="btn btn-primary">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast success" id="toast">Kayıt başarıyla kaydedildi.</div>

    <!-- Basit JS (sayfa içi) -->
    <script src="auth.js"></script>
    <script>
        // Saat gösterimi (demo)
        const timeEl = document.getElementById('current-time');
        function tick() {
            const d = new Date();
            timeEl.textContent = d.toLocaleString('tr-TR');
        }
        setInterval(tick, 1000); tick();

        // Menü toggle (placeholder)
        function toggleMenu() {
            // Gerekirse genişlet/daralt eklenebilir
            alert('Menü gizle/göster davranışı burada uygulanabilir.');
        }

        // Sayfadan beklenen global fonksiyonlar
        function showHomepage(){ window.location.href = 'index.html'; }

        // Arama: kutucukları filtrele
        const search = document.getElementById('search');
        const boxes = Array.from(document.querySelectorAll('.box'));
        search.addEventListener('input', () => {
            const q = search.value.toLowerCase().trim();
            boxes.forEach(b => {
                const hit = b.dataset.point.toLowerCase().includes(q);
                b.style.display = hit ? '' : 'none';
            });
        });

        // Modal kontrol
        const overlay = document.getElementById('overlay');
        const modal = document.getElementById('entry-modal');
        const btnOpen = document.getElementById('btn-open-modal');
        const btnClose = document.getElementById('btn-close-modal');
        const btnCancel = document.getElementById('btn-cancel');

        function openModal(prefillPoint) {
            if (prefillPoint) {
                document.getElementById('point').value = prefillPoint;
            }
            overlay.style.display = 'block';
            modal.style.display = 'flex';
            // Varsayılan tarih/saat
            const now = new Date();
            document.getElementById('date').value = now.toISOString().slice(0,10);
            document.getElementById('time').value = now.toTimeString().slice(0,5);
            document.getElementById('value').focus();
        }
        function closeModal() {
            overlay.style.display = 'none';
            modal.style.display = 'none';
            document.getElementById('entry-form').reset();
        }

        btnOpen.addEventListener('click', () => openModal());
        btnClose.addEventListener('click', closeModal);
        btnCancel.addEventListener('click', closeModal);
        overlay.addEventListener('click', closeModal);

        // Kutuya tıklayınca o kontrol noktası seçili gelsin
        boxes.forEach(b => b.addEventListener('click', () => {
            openModal(b.dataset.point);
        }));

        // Form kaydetme (demo) — burada backend'e POST atabilirsin
        const form = document.getElementById('entry-form');
        const toast = document.getElementById('toast');

        form.addEventListener('submit', (e) => {
            e.preventDefault();

            // Basit doğrulama
            const point = document.getElementById('point').value;
            const value = document.getElementById('value').value;
            const unit  = document.getElementById('unit').value;
            const date  = document.getElementById('date').value;
            const time  = document.getElementById('time').value;

            if (!point || !value || !unit || !date || !time) {
                alert('Lütfen zorunlu alanları doldurunuz.');
                return;
            }

            // pH değer kontrolü
            const phValue = parseFloat(value);
            if (phValue < 0 || phValue > 14) {
                alert('pH değeri 0-14 arasında olmalıdır.');
                return;
            }

            closeModal();
            showToast('Kayıt başarıyla kaydedildi.');
        });

        function showToast(msg) {
            toast.textContent = msg || 'İşlem başarılı.';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
